---
# create a host_vars/<hostname> file FIRST! and add it to ansible hosts file
# usage  $ ansible-playbook -i hosts -u root  --extra-vars "target=compute2" playbooks/add_node 
- name: create system in cobbler
  hosts: cobbler
  vars_prompt:
    - name: "profile"
      prompt: "cobbler profile"
      default: "centos6-x86_64"
  tasks:
    - command: cobbler system add
               --name={{ target }}
               --profile={{ profile }}
               --hostname={{ target }}
               --interface=auto
               --mac="{{ hostvars[target].interfaces.auto.mac }}"
               --dns-name="{{ hostvars[target].interfaces.auto.dns_name }}"
               --ip-address="{{ hostvars[target].interfaces.auto.ip }}"
               creates=/var/lib/cobbler/config/systems.d/{{ target }}.json
    - command: cobbler system edit
               --name={{ target }}
               --profile={{ profile }}
#      with_dict: hostvars[target]['interfaces'] 
    - command: cobbler sync
